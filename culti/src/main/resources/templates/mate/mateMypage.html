<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마이페이지 - CULTI</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/mate/mateMypage.css}">
    <link rel="stylesheet" th:href="@{/css/myPage.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <script th:src="@{/js/myPage.js}"></script>
</head>
<body>
    <!-- 헤더 -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">
                    <div class="logo-icon">C</div>
                    <span class="logo-text">CULTI</span>
                </a>
                <nav class="nav">
                    <a href="/">홈</a>
                    <a href="/mypage.html" class="active">마이페이지</a>
                    <button class="btn-logout" id="logoutBtn">로그아웃</button>
                </nav>
            </div>
        </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <main class="main">
        <div class="container">
            <div class="mypage-layout">
                <!-- 사이드바 -->
                <aside class="sidebar">
                    <div class="user-profile">
                        <div class="profile-image" id="profileImage">
                            <img src="" alt="프로필" id="profileImg">
                            <div class="profile-image-placeholder">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </div>
                        </div>
                        <div class="user-info">
                            <h2 class="user-name" id="userName" th:text="${user.name}">홍길동</h2>
                            <p class="user-email" id="userEmail" th:text="${user.email}">hong@example.com</p>
                        </div>
                        <div class="user-grade">
                            <span class="grade-badge">일반회원</span>
                        </div>
                    </div>

                    <nav class="sidebar-nav">
                        <button class="nav-item active" data-tab="dashboard">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                            <span>대시보드</span>
                        </button>
                        <button class="nav-item" data-tab="reservations">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <span>예매 내역</span>
                        </button>
                        <button class="nav-item" data-tab="benefits">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 6v6l4 2"></path>
                            </svg>
                            <span>쿠폰/포인트</span>
                        </button>
                        <button class="nav-item" data-tab="favorites">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                            </svg>
                            <span>찜 목록</span>
                        </button>
                        
                        <!--  -->
                        <button class="nav-item" data-tab="mate">
						  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
						    <circle cx="9" cy="7" r="4"></circle>
						    <path d="M17 11l2 2l4-4"></path>
						  </svg>
						  <span>동행 매칭 관리</span>
						</button>
						<!--  -->
						
                        <button class="nav-item" data-tab="cancellations">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                            <span>취소/환불 내역</span>
                        </button>
                        <button class="nav-item" data-tab="profile">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <span>회원정보 수정</span>
                        </button>
                    </nav>
                </aside>

                <!-- 메인 컨텐츠 영역 -->
                <div class="content">
                    <!-- 대시보드 -->
                    <section class="tab-content active" id="dashboard">
                        <h1 class="content-title">대시보드</h1>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">🎫</div>
                                <div class="stat-info">
                                    <span class="stat-label">예매 티켓</span>
                                    <span class="stat-value" id="ticketCount">3</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">🎁</div>
                                <div class="stat-info">
                                    <span class="stat-label">보유 쿠폰</span>
                                    <span class="stat-value" id="couponCount">5</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">⭐</div>
                                <div class="stat-info">
                                    <span class="stat-label">포인트</span>
                                    <span class="stat-value" id="pointCount">15,000P</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">❤️</div>
                                <div class="stat-info">
                                    <span class="stat-label">찜 목록</span>
                                    <span class="stat-value" id="favoriteCount">12</span>
                                </div>
                            </div>
                        </div>

                        <div class="recent-section">
                            <h2 class="section-title">최근 예매 내역</h2>
                            <div class="reservation-list" id="recentReservations">
                                <!-- JavaScript로 동적 생성 -->
                            </div>
                        </div>
                    </section>

                    <!-- 예매 내역 -->
                    <section class="tab-content" id="reservations">
                        <h1 class="content-title">예매 내역</h1>
                        
                        <div class="filter-tabs">
                            <button class="filter-tab active" data-filter="all">전체</button>
                            <button class="filter-tab" data-filter="movie">영화</button>
                            <button class="filter-tab" data-filter="exhibition">전시</button>
                            <button class="filter-tab" data-filter="performance">공연</button>
                        </div>

                        <div class="reservation-list" id="allReservations">
                            <!-- JavaScript로 동적 생성 -->
                        </div>
                    </section>

                    <!-- 쿠폰/포인트 -->
                    <section class="tab-content" id="benefits">
                        <h1 class="content-title">쿠폰/포인트</h1>
                        
                        <div class="benefits-tabs">
                            <button class="benefit-tab active" data-benefit="coupons">쿠폰</button>
                            <button class="benefit-tab" data-benefit="points">포인트</button>
                        </div>

                        <div class="benefit-content">
                            <div class="benefit-section active" id="coupons">
                                <div class="coupon-list" id="couponList">
                                    <!-- JavaScript로 동적 생성 -->
                                </div>
                            </div>

                            <div class="benefit-section" id="points">
                                <div class="point-summary">
                                    <div class="point-card">
                                        <h3>보유 포인트</h3>
                                        <p class="point-amount">15,000 P</p>
                                    </div>
                                    <div class="point-card">
                                        <h3>소멸 예정 포인트</h3>
                                        <p class="point-amount expiring">3,000 P</p>
                                        <span class="expiry-date">2026.03.31 소멸</span>
                                    </div>
                                </div>

                                <h3 class="subsection-title">포인트 내역</h3>
                                <div class="point-list" id="pointList">
                                    <!-- JavaScript로 동적 생성 -->
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 찜 목록 -->
                    <section class="tab-content" id="favorites">
                        <h1 class="content-title">찜 목록</h1>
                        
                        <div class="favorites-grid" id="favoritesList">
                            <!-- JavaScript로 동적 생성 -->
                        </div>
                    </section>

                    <!-- 취소/환불 내역 -->
                    <section class="tab-content" id="cancellations">
                        <h1 class="content-title">취소/환불 내역</h1>
                        <div class="reservation-list" id="cancellationList">
                            <!-- JavaScript로 동적 생성 -->
                        </div>
                    </section>

                    <!-- 회원정보 수정 -->
                    <section class="tab-content" id="profile">
                        <h1 class="content-title">회원정보 수정</h1>
                        
                        <form class="profile-form" id="profileForm">
                            <div class="form-section">
                                <h3 class="form-section-title">기본 정보</h3>
                                
                                <div class="form-group">
                                    <label for="profileName">이름</label>
                                    <input type="text" id="profileName" value="홍길동">
                                </div>

                                <div class="form-group">
                                    <label for="profileNickname">닉네임</label>
                                    <input type="text" id="profileNickname" value="길동이">
                                </div>

                                <div class="form-group">
                                    <label for="profileEmail">이메일</label>
                                    <input type="email" id="profileEmail" value="hong@example.com" disabled>
                                    <span class="form-help">이메일은 변경할 수 없습니다.</span>
                                </div>

                                <div class="form-group">
                                    <label for="profilePhone">전화번호</label>
                                    <input type="tel" id="profilePhone" value="010-1234-5678">
                                </div>

                                <div class="form-group">
                                    <label for="profileBirth">생년월일</label>
                                    <input type="date" id="profileBirth" value="1990-01-01">
                                </div>

                                <div class="form-group">
                                    <label>성별</label>
                                    <div class="radio-group">
                                        <label class="radio-label">
                                            <input type="radio" name="gender" value="male" checked>
                                            <span>남성</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="gender" value="female">
                                            <span>여성</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="gender" value="other">
                                            <span>선택안함</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3 class="form-section-title">비밀번호 변경</h3>
                                
                                <div class="form-group">
                                    <label for="currentPassword">현재 비밀번호</label>
                                    <input type="password" id="currentPassword" placeholder="현재 비밀번호를 입력하세요">
                                </div>

                                <div class="form-group">
                                    <label for="newPassword">새 비밀번호</label>
                                    <input type="password" id="newPassword" placeholder="새 비밀번호를 입력하세요">
                                </div>

                                <div class="form-group">
                                    <label for="confirmPassword">새 비밀번호 확인</label>
                                    <input type="password" id="confirmPassword" placeholder="새 비밀번호를 다시 입력하세요">
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">저장하기</button>
                                <button type="button" class="btn btn-secondary" id="cancelEdit">취소</button>
                            </div>
                        </form>

                        <div class="danger-zone">
                            <h3 class="danger-title">회원 탈퇴</h3>
                            <p class="danger-description">회원 탈퇴 시 모든 정보가 삭제되며 복구할 수 없습니다.</p>
                            <button class="btn btn-danger" id="deleteAccountBtn">회원 탈퇴</button>
                        </div>
                    </section>
                    
                    <!--  ================동행매칭=================== -->
				    
					<section class="tab-content" id="mate">
					<div class="mate-manage">
					  <h1 class="content-title">동행 매칭 관리</h1>
					

					  <!-- Tabs -->
					  <div class="tabs">
						  <a class="tab"
						     th:classappend="${tab}=='received' ? ' active' : ''"
						     th:href="@{/mate/mateMypage(tab='received', section='mate')}">
						    받은 신청
						  </a>
						
						  <a class="tab"
						     th:classappend="${tab}=='sent' ? ' active' : ''"
						     th:href="@{/mate/mateMypage(tab='sent', section='mate')}">
						    내가 신청한 것
						  </a>
						</div>
					  
					
					  <!-- Content -->
					  <div id="mate-content">
					
					    <!-- 받은 신청 -->
					    <div th:if="${tab}=='received'">
					
					      <div th:if="${#lists.isEmpty(receivedApps)}" class="empty-state">
					        <i class="fa-solid fa-user-group" style="font-size:4rem; color:#ccc;"></i>
					        <h3>받은 신청이 없습니다</h3>
					        <p>게시글을 작성하고 동행을 기다려보세요!</p>
					      </div>
					
					      <div th:each="app : ${receivedApps}" class="application-card">
					        <div class="application-header">
					          <div class="application-info">
					            <div class="application-title" th:text="${app.postTitle}">제목</div>
					            <div class="application-meta">
					              <span>신청자: <strong th:text="${app.applicantNickname}">닉네임</strong></span> ·
					              <span th:text="${#temporals.format(app.createdAt,'yyyy-MM-dd')}">2026-02-26</span>
					            </div>
					          </div>
					
					          <div class="application-actions">
					            <span class="badge"
					                  th:classappend="' badge-' + ${app.status}"
					                  th:text="${app.statusLabel}">
					              대기중
					            </span>
					
					            <div th:if="${app.status}=='PENDING'">
								  <form th:action="@{/mate/{id}/accept(id=${app.id})}" method="post">
									  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
									  <button type="submit">수락</button>
									</form>
									
									<form th:action="@{/mate/{id}/reject(id=${app.id})}" method="post">
									  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
									  <button type="submit">거절</button>
									</form>
								</div>
					          </div>
					        </div>
					
					        <div class="application-details">
					          <div class="info-row">
					            <i class="fa-regular fa-calendar"></i>
					            <span th:text="${app.eventAtText}">2026-02-26 19:00</span>
					          </div>
					          <div class="info-row">
					            <i class="fa-solid fa-location-dot"></i>
					            <span th:text="${app.location}">서울 어딘가</span>
					          </div>
					        </div>
					      </div>
					    </div>
					
					    <!-- 내가 신청한 것 -->
					    <div th:if="${tab}=='sent'">
					
					      <div th:if="${#lists.isEmpty(sentApps)}" class="empty-state">
					        <i class="fa-solid fa-paper-plane" style="font-size:4rem; color:#ccc;"></i>
					        <h3>신청한 게시글이 없습니다</h3>
					        <p>마음에 드는 게시글에 동행을 신청해보세요!</p>
					      </div>
					
					      <div th:each="app : ${sentApps}" class="application-card">
					        <div class="application-header">
					          <div class="application-info">
					            <div class="application-title" th:text="${app.postTitle}">제목</div>
					            <div class="application-meta">
					              <span>작성자: <strong th:text="${app.writerNickname}">작성자</strong></span> ·
					              <span th:text="${#temporals.format(app.createdAt,'yyyy-MM-dd')}">2026-02-26</span>
					            </div>
					          </div>
					
					          <div class="application-actions">
					            <span class="badge"
					                  th:classappend="' badge-' + ${app.status}"
					                  th:text="${app.statusLabel}">
					              대기중
					            </span>
					
					            <div th:if="${app.status}=='PENDING'">
								  <form th:action="@{/mate/{id}/cancel(id=${app.id})}" method="post">
									  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
									  <button type="submit">취소</button>
									</form>
								</div>
					          </div>
					        </div>
					
					        <div class="application-details">
					          <div class="info-row">
					            <i class="fa-regular fa-calendar"></i>
					            <span th:text="${app.eventAtText}">2026-02-26 19:00</span>
					          </div>
					          <div class="info-row">
					            <i class="fa-solid fa-location-dot"></i>
					            <span th:text="${app.location}">서울 어딘가</span>
					          </div>
					        </div>
					      </div>
					    </div>
					
					  </div>
					  </div>
					</section>
				                    
                    
                    
                    
      				<!-- ============동행매칭==================== -->              
                    
                </div>
            </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2026 CULTI. All rights reserved.</p>
                <div class="footer-links">
                    <a href="/terms">이용약관</a>
                    <a href="/privacy">개인정보처리방침</a>
                    <a href="/help">고객센터</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- 회원 탈퇴 확인 모달 -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-container modal-small">
            <div class="modal-header">
                <h2>회원 탈퇴</h2>
                <button type="button" class="modal-close" id="closeDeleteModal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-warning">정말로 탈퇴하시겠습니까?</p>
                <p class="modal-description">탈퇴 시 모든 예매 내역, 포인트, 쿠폰이 삭제되며 복구할 수 없습니다.</p>
                <div class="form-group">
                    <label for="deletePassword">비밀번호 확인</label>
                    <input type="password" id="deletePassword" placeholder="비밀번호를 입력하세요">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelDelete">취소</button>
                <button type="button" class="btn btn-danger" id="confirmDelete">탈퇴하기</button>
            </div>
        </div>
    </div>
    
    

</body>
</html>