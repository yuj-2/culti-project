<!DOCTYPE html>
<html 
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/layout}">
<head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/mate/mate.css}">
</head>

<body>
	


<div layout:fragment="content">
    <!-- Filter Tabs -->
    <div class="filter-section">
        <div class="tabs">
            <button class="tab-button active" data-category="all">ì „ì²´</button>
            <button class="tab-button" data-category="movie">ì˜í™”</button>
            <button class="tab-button" data-category="concert">ê³µì—°</button>
            <button class="tab-button" data-category="exhibition">ì „ì‹œ</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="posts-grid" id="postsGrid">
            <!-- Posts will be inserted here by JavaScript -->
        </div>
        <div class="empty-state" id="emptyState" style="display: none;">
            <p>ì•„ì§ ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>
    
    <!-- ì‘í’ˆ ì¹´ë“œì°½ -->
		<div class="posts-grid">
		  <div class="post-card" th:each="p : ${paging.content}" 
		  th:attr="data-id=${p.postId},
		   data-title=${p.title},
	       data-category=${p.category.name()},
	       data-eventAt=${#temporals.format(p.eventAt,'yyyy-MM-dd HH:mm')},
	       data-location=${p.location},
	       data-maxPeople=${p.maxPeople},
	       data-description=${p.description}">
		    <div class="post-header">
		      <h3 class="post-title" th:text="${p.title}">ì œëª©</h3>
		      <span class="badge"
		            th:text="${p.category}"
		            th:classappend="' badge-' + ${#strings.toLowerCase(p.category.name())}">
		      </span>
		    </div>
		
		    <div class="post-info">
		      <div class="info-row">
		        <i class="fa-regular fa-calendar"></i>
		        <span th:text="${#temporals.format(p.eventAt, 'yyyy-MM-dd HH:mm')}"></span>
		      </div>
		
		      <div class="info-row">
		        <i class="fa-solid fa-location-dot"></i>
		        <span th:text="${p.location}"></span>
		      </div>
		
		      <div class="info-row">
		        <i class="fa-solid fa-users"></i>
		        <span><span th:text="${p.maxPeople}"></span>ëª…</span>
		      </div>
		    </div>
		  </div>
		</div>

    <!-- Floating Button -->
	<button class="floating-button" id="createButton">
	  <i class="fa-solid fa-plus"></i>
	</button>
    
    
    
    

    <!-- ê²Œì‹œê¸€ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="createModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ë™í–‰ êµ¬í•˜ê¸°</h2>
                <button class="close-button" onclick="closeCreateModal()">&times;</button>
            </div>
            <form id="createForm">
                <div class="form-group">
                    <label class="form-label" for="title">ì‘í’ˆëª…</label>
                    
                    <!-- ì—¬ê¸° content db ë¶ˆëŸ¬ì˜¤ëŠ” ê±¸ë¡œ ìˆ˜ì •!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
                    <input type="text" class="form-input" id="title" placeholder="ì˜ˆ) ë“„: íŒŒíŠ¸2" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="category">ì¹´í…Œê³ ë¦¬</label>
                    <select class="form-select" id="category" required>
                        <option value="movie">ì˜í™”</option>
                        <option value="concert">ê³µì—°</option>
                        <option value="exhibition">ì „ì‹œ</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="date">ë‚ ì§œ</label>
                        <input type="date" class="form-input" id="date" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="time">ì‹œê°„</label>
                        <input type="time" class="form-input" id="time" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="location">ì¥ì†Œ</label>
                    <input type="text" class="form-input" id="location" placeholder="ì˜ˆ) CGV ê°•ë‚¨" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="maxMembers">ëª¨ì§‘ ì¸ì›</label>
                    <select class="form-select" id="maxMembers" required>
                        <option value="2">2ëª…</option>
                        <option value="3">3ëª…</option>
                        <option value="4">4ëª…</option>
                        <option value="5">5ëª…</option>
                        <option value="6">6ëª…</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="author">ì‘ì„±ì ë‹‰ë„¤ì„</label>
                    <input type="text" class="form-input" id="author" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="description">ìƒì„¸ ì„¤ëª…</label>
                    <textarea class="form-textarea" id="description" placeholder="í•¨ê»˜ ë³´ê³  ì‹¶ì€ ì´ìœ , ì„ í˜¸í•˜ëŠ” ë¶„ìœ„ê¸° ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”" required></textarea>
                </div>

                <div class="button-group">
                    <button type="button" class="button button-secondary" onclick="closeCreateModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="button button-primary">ë“±ë¡í•˜ê¸°</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="detailTitle"></h2>
                <button class="close-button" onclick="closeDetailModal()">&times;</button>
            </div>
            <div id="detailContent"></div>
        </div>
    </div>
    
<!-- ì°¸ì—¬ ì‹ ì²­ ëª¨ë‹¬ -->
<div class="modal-overlay" id="applyModal">
  <div class="modal apply-modal">

    <!-- í—¤ë” -->
    <div class="modal-header">
      <h2 class="modal-title">ì°¸ì—¬ ì‹ ì²­</h2>
      <button class="close-button" onclick="closeApplyModal()">&times;</button>
    </div>

    <!-- ë³¸ë¬¸ -->
    <div class="form-group">
      <label class="form-label">ì‘ì„±ìì—ê²Œ ì „ë‹¬í•  ë©”ì‹œì§€</label>
      <textarea
        class="form-textarea apply-textarea"
        id="applyMessage"
        placeholder="ìê¸°ì†Œê°œë‚˜ í•¨ê»˜ ë³´ê³  ì‹¶ì€ ì´ìœ ë¥¼ ì ì–´ì£¼ì„¸ìš” ğŸ˜Š"
      ></textarea>
    </div>

    <!-- ë²„íŠ¼ ì˜ì—­ -->
    <div class="apply-actions">
      <button class="button button-secondary" onclick="closeApplyModal()">
        ì·¨ì†Œ
      </button>

      <button class="button button-primary" onclick="submitApply()">
        ì‹ ì²­í•˜ê¸°
      </button>
    </div>

  </div>
</div>

    <script>
        

        let currentCategory = 'all';
        const categoryLabels = {
            movie: 'ì˜í™”',
            concert: 'ê³µì—°',
            exhibition: 'ì „ì‹œ'
        };

//      // Render posts
//         function renderPosts() {
//           const grid = document.getElementById('postsGrid');
//           const emptyState = document.getElementById('emptyState');

//           const filteredPosts = currentCategory === 'all'
//             ? posts
//             : posts.filter(post => post.category === currentCategory);

//           if (filteredPosts.length === 0) {
//             grid.style.display = 'none';
//             emptyState.style.display = 'block';
//             return;
//           }

//           grid.style.display = 'grid';
//           emptyState.style.display = 'none';

//           grid.innerHTML = filteredPosts.map(post => {
//             const isFull = post.currentMembers >= post.maxMembers;
//             const badgeClass = `badge-${post.category}`;

//             return `
//               <div class="post-card" onclick="showDetail('${post.id}')">
//                 <div class="post-header">
//                   <h3 class="post-title">${post.title}</h3>
//                   <span class="badge ${badgeClass}">${categoryLabels[post.category]}</span>
//                 </div>

//                 <div class="post-info">
//                   <div class="info-row">
//                     <i class="fa-regular fa-calendar"></i>
//                     <span>${post.date} ${post.time}</span>
//                   </div>

//                   <div class="info-row">
//                     <i class="fa-solid fa-location-dot"></i>
//                     <span>${post.location}</span>
//                   </div>

//                   <div class="info-row">
//                     <i class="fa-solid fa-users"></i>
//                     <span>
//                       <span class="members-count ${isFull ? 'full' : ''}">${post.currentMembers}</span>
//                       <span style="color: #666">/${post.maxMembers}ëª…</span>
//                       ${isFull ? '<span class="badge badge-full">ëª¨ì§‘ì™„ë£Œ</span>' : ''}
//                     </span>
//                   </div>
//                 </div>

//                 <div class="post-footer">
//                   <div class="info-row">
//                     <i class="fa-regular fa-user"></i>
//                     <span>${post.author}</span>
//                   </div>
//                 </div>
//               </div>
//             `;
//           }).join('');
//         }

        // Filter tabs
        document.querySelectorAll('.tab-button').forEach(button => {
          button.addEventListener('click', (e) => {
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            currentCategory = e.target.dataset.category;
            renderPosts();
          });
        });
        
        // ëª¨ë‹¬ì°½
        document.querySelectorAll('.post-card').forEach(card => {
		  card.addEventListener('click', () => {
		    const title = card.dataset.title;
		    const category = card.dataset.category;     // MOVIE/CONCERT/EXHIBITION
		    const eventAt = card.dataset.eventat;
		    const location = card.dataset.location;
		    const maxPeople = card.dataset.maxpeople;
		    const desc = card.dataset.description || '';
		
		    document.getElementById('detailTitle').innerHTML =
		      `${title} <span class="badge badge-${category.toLowerCase()}" style="margin-left:20px;">${category}</span>`;
		
		    document.getElementById('detailContent').innerHTML = `
		      <div class="detail-grid">
		        <div class="detail-item"><i class="fa-regular fa-calendar detail-fa"></i>
		          <div class="detail-content"><div class="detail-label">ë‚ ì§œ ë° ì‹œê°„</div><div class="detail-value">${eventAt}</div></div>
		        </div>
		        <div class="detail-item"><i class="fa-solid fa-location-dot detail-fa"></i>
		          <div class="detail-content"><div class="detail-label">ì¥ì†Œ</div><div class="detail-value">${location}</div></div>
		        </div>
		        <div class="detail-item"><i class="fa-solid fa-users detail-fa"></i>
		          <div class="detail-content"><div class="detail-label">ëª¨ì§‘ ì¸ì›</div><div class="detail-value">${maxPeople}ëª…</div></div>
		        </div>
		      </div>
		
		      <div class="detail-description">
		        <div class="detail-label">ìƒì„¸ ì„¤ëª…</div>
		        <p class="description-text">${desc}</p>
		      </div>
		
		      <div class="button-group">
		        <button class="button button-primary" onclick="openApplyModal()">ì°¸ì—¬ ì‹ ì²­</button>
		      </div>
		    `;
		
		    document.getElementById('detailModal').classList.add('show');
		  });
		});

        // Show detail modal
//         function showDetail(postId) {
//           const post = posts.find(p => p.id === postId);
//           if (!post) return;

//           const isFull = post.currentMembers >= post.maxMembers;
//           const badgeClass = `badge-${post.category}`;

//           // âœ… ê¸°ë³¸ê°’ ì²˜ë¦¬
//           const isAccepted = post.isAccepted === true;
//           const comments = Array.isArray(post.comments) ? post.comments : [];

//           document.getElementById('detailTitle').innerHTML = `
//             ${post.title}
//             <span class="badge ${badgeClass}" style="font-size: 0.875rem; margin-left: 0.5rem;">
//               ${categoryLabels[post.category]}
//             </span>
//           `;

//           const commentsHtml = isAccepted
//             ? `
//               <div class="detail-description">
//                 <div class="detail-label">ëŒ“ê¸€</div>

//                 <div class="comment-list">
//                   ${
//                     comments.length === 0
//                       ? `<p style="color:#666; font-size:0.9rem;">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>`
//                       : comments.map(c => `
//                           <div class="comment-item">
//                             <div class="comment-meta">
//                               <span class="comment-writer">${c.writer}</span>
//                               <span class="comment-date">${c.createdAt}</span>
//                             </div>
//                             <div class="comment-content">${c.content}</div>
//                           </div>
//                         `).join('')
//                   }
//                 </div>

//                 <div class="comment-form">
//                   <textarea id="commentInput" class="form-textarea" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
//                   <div class="button-group" style="margin-top: 0.75rem;">
//                     <button class="button button-primary" onclick="addComment('${post.id}')">ëŒ“ê¸€ ë“±ë¡</button>
//                   </div>
//                 </div>
//               </div>
//             `
//             : `
//               <div class="detail-description">
//                 <div class="detail-label">ëŒ“ê¸€</div>
//                 <p style="color:#666; font-size:0.9rem;">
//                   âœ… ì°¸ì—¬ ì‹ ì²­ì´ ìˆ˜ë½ë˜ë©´ ëŒ“ê¸€ì„ ë³¼ ìˆ˜ ìˆì–´ìš”.
//                 </p>
//               </div>
//             `;

//           document.getElementById('detailContent').innerHTML = `
//             <div class="detail-grid">

//               <div class="detail-item">
//                 <i class="fa-regular fa-calendar detail-fa"></i>
//                 <div class="detail-content">
//                   <div class="detail-label">ë‚ ì§œ ë° ì‹œê°„</div>
//                   <div class="detail-value">${post.date} ${post.time}</div>
//                 </div>
//               </div>

//               <div class="detail-item">
//                 <i class="fa-solid fa-location-dot detail-fa"></i>
//                 <div class="detail-content">
//                   <div class="detail-label">ì¥ì†Œ</div>
//                   <div class="detail-value">${post.location}</div>
//                 </div>
//               </div>

//               <div class="detail-item">
//                 <i class="fa-solid fa-users detail-fa"></i>
//                 <div class="detail-content">
//                   <div class="detail-label">ëª¨ì§‘ ì¸ì›</div>
//                   <div class="detail-value">
//                     <span class="${isFull ? 'members-count full' : 'members-count'}">${post.currentMembers}</span>/${post.maxMembers}ëª…
//                     ${isFull ? '<span class="badge badge-full">ëª¨ì§‘ì™„ë£Œ</span>' : ''}
//                   </div>
//                 </div>
//               </div>

//               <div class="detail-item">
//                 <i class="fa-regular fa-user detail-fa"></i>
//                 <div class="detail-content">
//                   <div class="detail-label">ì‘ì„±ì</div>
//                   <div class="detail-value">${post.author}</div>
//                 </div>
//               </div>

//             </div>

//             <div class="detail-description">
//               <div class="detail-label">ìƒì„¸ ì„¤ëª…</div>
//               <p class="description-text">${post.description}</p>
//             </div>

//             <div class="button-group">
//               <button class="button button-primary"
//                 onclick="openApplyModal()"
//                 ${isFull ? 'disabled' : ''}>
//                 ${isFull ? 'ëª¨ì§‘ ì™„ë£Œ' : 'ì°¸ì—¬ ì‹ ì²­'}
//               </button>
//             </div>

//             ${commentsHtml}
//           `;

//           document.getElementById('detailModal').classList.add('show');
//         }

        function closeDetailModal() {
          document.getElementById('detailModal').classList.remove('show');
        }
        
        function openApplyModal() {
       	  document.getElementById('applyModal').classList.add('show');
       	}

       	function closeApplyModal() {
       	  document.getElementById('applyModal').classList.remove('show');
       	}

       	function submitApply() {
       	  const message = document.getElementById('applyMessage').value;

       	  alert("ì‹ ì²­ ì™„ë£Œ!");
       	  closeApplyModal();
       	}

//         // Initial render
//         renderPosts();
        
        
     // âœ… ìƒˆê¸€ ëª¨ë‹¬ ì—´ê¸°
        document.getElementById('createButton').addEventListener('click', () => {
          document.getElementById('createModal').classList.add('show');
        });

        // âœ… ìƒˆê¸€ ëª¨ë‹¬ ë‹«ê¸°
        function closeCreateModal() {
          document.getElementById('createModal').classList.remove('show');
          document.getElementById('createForm').reset();
        }

        // âœ… ì˜¤ë²„ë ˆì´(ë°”ê¹¥) í´ë¦­ ì‹œ ë‹«ê¸°
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
          overlay.addEventListener('click', (e) => {
            if (e.target === overlay) overlay.classList.remove('show');
          });
        });
    </script>
</div>

</body>
</html>
	