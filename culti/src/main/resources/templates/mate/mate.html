<!DOCTYPE html>
<html 
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/layout}">
<head>
    <link rel="stylesheet" th:href="@{/css/mate/mate.css}">
</head>

<body>
	


<div layout:fragment="content">
    <!-- Filter Tabs -->
    <div class="filter-section">
        <div class="tabs">
            <button class="tab-button active" data-category="all">ì „ì²´</button>
            <button class="tab-button" data-category="movie">ì˜í™”</button>
            <button class="tab-button" data-category="concert">ê³µì—°</button>
            <button class="tab-button" data-category="exhibition">ì „ì‹œ</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="posts-grid" id="postsGrid">
            <!-- Posts will be inserted here by JavaScript -->
        </div>
        <div class="empty-state" id="emptyState" style="display: none;">
            <p>ì•„ì§ ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- Floating Button -->
    <button class="floating-button" id="createButton">
        <svg class="icon" style="width: 1.5rem; height: 1.5rem;">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
    </button>

    <!-- ê²Œì‹œê¸€ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="createModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ë™í–‰ êµ¬í•˜ê¸°</h2>
                <button class="close-button" onclick="closeCreateModal()">&times;</button>
            </div>
            <form id="createForm">
                <div class="form-group">
                    <label class="form-label" for="title">ì‘í’ˆëª…</label>
                    <input type="text" class="form-input" id="title" placeholder="ì˜ˆ) ë“„: íŒŒíŠ¸2" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="category">ì¹´í…Œê³ ë¦¬</label>
                    <select class="form-select" id="category" required>
                        <option value="movie">ì˜í™”</option>
                        <option value="concert">ê³µì—°</option>
                        <option value="exhibition">ì „ì‹œ</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="date">ë‚ ì§œ</label>
                        <input type="date" class="form-input" id="date" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="time">ì‹œê°„</label>
                        <input type="time" class="form-input" id="time" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="location">ì¥ì†Œ</label>
                    <input type="text" class="form-input" id="location" placeholder="ì˜ˆ) CGV ê°•ë‚¨" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="maxMembers">ëª¨ì§‘ ì¸ì›</label>
                    <select class="form-select" id="maxMembers" required>
                        <option value="2">2ëª…</option>
                        <option value="3">3ëª…</option>
                        <option value="4">4ëª…</option>
                        <option value="5">5ëª…</option>
                        <option value="6">6ëª…</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="author">ì‘ì„±ì ë‹‰ë„¤ì„</label>
                    <input type="text" class="form-input" id="author" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="description">ìƒì„¸ ì„¤ëª…</label>
                    <textarea class="form-textarea" id="description" placeholder="í•¨ê»˜ ë³´ê³  ì‹¶ì€ ì´ìœ , ì„ í˜¸í•˜ëŠ” ë¶„ìœ„ê¸° ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”" required></textarea>
                </div>

                <div class="button-group">
                    <button type="button" class="button button-secondary" onclick="closeCreateModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="button button-primary">ë“±ë¡í•˜ê¸°</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="detailTitle"></h2>
                <button class="close-button" onclick="closeDetailModal()">&times;</button>
            </div>
            <div id="detailContent"></div>
        </div>
    </div>
    
<!-- ì°¸ì—¬ ì‹ ì²­ ëª¨ë‹¬ -->
<div class="modal-overlay" id="applyModal">
  <div class="modal apply-modal">

    <!-- í—¤ë” -->
    <div class="modal-header">
      <h2 class="modal-title">ì°¸ì—¬ ì‹ ì²­</h2>
      <button class="close-button" onclick="closeApplyModal()">&times;</button>
    </div>

    <!-- ë³¸ë¬¸ -->
    <div class="form-group">
      <label class="form-label">ì‘ì„±ìì—ê²Œ ì „ë‹¬í•  ë©”ì‹œì§€</label>
      <textarea
        class="form-textarea apply-textarea"
        id="applyMessage"
        placeholder="ìê¸°ì†Œê°œë‚˜ í•¨ê»˜ ë³´ê³  ì‹¶ì€ ì´ìœ ë¥¼ ì ì–´ì£¼ì„¸ìš” ğŸ˜Š"
      ></textarea>
    </div>

    <!-- ë²„íŠ¼ ì˜ì—­ -->
    <div class="apply-actions">
      <button class="button button-secondary" onclick="closeApplyModal()">
        ì·¨ì†Œ
      </button>

      <button class="button button-primary" onclick="submitApply()">
        ì‹ ì²­í•˜ê¸°
      </button>
    </div>

  </div>
</div>

    <script>
        // Initial posts data
        let posts = [
            {
                id: '1',
                title: 'ë“„: íŒŒíŠ¸2',
                category: 'movie',
                date: '2026-02-25',
                time: '19:30',
                location: 'CGV ê°•ë‚¨',
                currentMembers: 2,
                maxMembers: 4,
                author: 'ì˜í™”ë§¤ë‹ˆì•„',
                description: 'SF ì˜í™” ì¢‹ì•„í•˜ì‹œëŠ” ë¶„ë“¤ê³¼ í•¨ê»˜ ë³´ê³  ì‹¶ì–´ìš”! ìƒì˜ í›„ ê·¼ì²˜ ì¹´í˜ì—ì„œ ì˜í™” ì´ì•¼ê¸° ë‚˜ëˆ„ë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ìš” ğŸ˜Š',
                createdAt: '2026-02-20T10:00:00',
                isAccepted: true,
                comments: [
                  { id:'c1', writer:'ì˜í™”ë§¤ë‹ˆì•„', content:'ìˆ˜ë½í–ˆì–´ìš”! ê°™ì´ ê°€ìš”', createdAt:'2026-02-21' }
                ]
            },
            {
                id: '2',
                title: 'ì˜¤í˜ë¼ì˜ ìœ ë ¹',
                category: 'concert',
                date: '2026-03-10',
                time: '14:00',
                location: 'ìƒ¤ë¡¯ë°ì”¨ì–´í„°',
                currentMembers: 1,
                maxMembers: 2,
                author: 'ë®¤ì§€ì»¬ëŸ¬ë²„',
                description: 'ë®¤ì§€ì»¬ ì²˜ìŒ ë³´ëŠ”ë° ê°™ì´ ë³´ì‹¤ ë¶„ êµ¬í•´ìš”! ê³µì—° ì „ì— ì ì‹¬ ê°™ì´ ë¨¹ì–´ë„ ì¢‹ì•„ìš”.',
                createdAt: '2026-02-19T15:30:00'
            },
            {
                id: '3',
                title: 'ì¸ìƒíŒŒ ê±°ì¥ì „',
                category: 'exhibition',
                date: '2026-02-28',
                time: '11:00',
                location: 'êµ­ë¦½ì¤‘ì•™ë°•ë¬¼ê´€',
                currentMembers: 3,
                maxMembers: 3,
                author: 'ì•„íŠ¸ì¸ì‚¬ì´ë”',
                description: 'ì¸ìƒíŒŒ ê·¸ë¦¼ ë„ˆë¬´ ì¢‹ì•„í•´ì„œ ì—¬ëŸ¬ ë²ˆ ê°€ë ¤ê³  í•´ìš”. í•¨ê»˜ ê´€ëŒí•˜ë©° ì´ì•¼ê¸° ë‚˜ëˆ ìš”!',
                createdAt: '2026-02-18T09:00:00'
            },
            {
                id: '4',
                title: 'ìœ„í‚¤ë“œ',
                category: 'concert',
                date: '2026-03-15',
                time: '19:30',
                location: 'ë¸”ë£¨ìŠ¤í€˜ì–´',
                currentMembers: 2,
                maxMembers: 4,
                author: 'ë®¤ë•',
                description: 'ìœ„í‚¤ë“œ ë„˜ë²„ë“¤ ë„ˆë¬´ ì¢‹ì•„ìš”! ê°™ì´ ë³´ê³  OST ì´ì•¼ê¸°í•˜ì‹¤ ë¶„ êµ¬í•©ë‹ˆë‹¤ ğŸ­',
                createdAt: '2026-02-20T14:00:00'
            },
            {
                id: '5',
                title: 'ëª¨ë˜ ì•„íŠ¸ í˜ì–´',
                category: 'exhibition',
                date: '2026-03-05',
                time: '15:00',
                location: 'ì˜ˆìˆ ì˜ì „ë‹¹',
                currentMembers: 1,
                maxMembers: 3,
                author: 'ë¯¸ìˆ ì• í˜¸ê°€',
                description: 'í˜„ëŒ€ë¯¸ìˆ ì— ê´€ì‹¬ ë§ìœ¼ì‹  ë¶„ë“¤ê³¼ í•¨ê»˜ ë‘˜ëŸ¬ë³´ê³  ì‹¶ì–´ìš”. ì²œì²œíˆ ê´€ëŒí•˜ë©° ëŒ€í™” ë‚˜ëˆ ìš”.',
                createdAt: '2026-02-19T11:20:00'
            },
            {
                id: '6',
                title: 'ì¸í„°ìŠ¤í…”ë¼',
                category: 'movie',
                date: '2026-03-01',
                time: '21:00',
                location: 'ë©”ê°€ë°•ìŠ¤ ì½”ì—‘ìŠ¤',
                currentMembers: 3,
                maxMembers: 4,
                author: 'ì˜í™”ê´‘',
                description: 'IMAXë¡œ ë‹¤ì‹œ ë³´ëŠ” ì¸í„°ìŠ¤í…”ë¼! SF ì˜í™” ë•í›„ë“¤ ëª¨ì—¬ë¼~ ìƒì˜ í›„ ê°ìƒí‰ ê³µìœ í•´ìš”!',
                createdAt: '2026-02-17T16:45:00'
            }
        ];

        let currentCategory = 'all';
        const categoryLabels = {
            movie: 'ì˜í™”',
            concert: 'ê³µì—°',
            exhibition: 'ì „ì‹œ'
        };

        // Render posts
        function renderPosts() {
            const grid = document.getElementById('postsGrid');
            const emptyState = document.getElementById('emptyState');
            
            const filteredPosts = currentCategory === 'all' 
                ? posts 
                : posts.filter(post => post.category === currentCategory);

            if (filteredPosts.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            grid.style.display = 'grid';
            emptyState.style.display = 'none';
            
            grid.innerHTML = filteredPosts.map(post => {
                const isFull = post.currentMembers >= post.maxMembers;
                const badgeClass = `badge-${post.category}`;
                
                return `
                    <div class="post-card" onclick="showDetail('${post.id}')">
                        <div class="post-header">
                            <h3 class="post-title">${post.title}</h3>
                            <span class="badge ${badgeClass}">${categoryLabels[post.category]}</span>
                        </div>
                        <div class="post-info">
                            <div class="info-row">
                                <svg class="icon">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                <span>${post.date} ${post.time}</span>
                            </div>
                            <div class="info-row">
                                <svg class="icon">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                    <circle cx="12" cy="10" r="3"></circle>
                                </svg>
                                <span>${post.location}</span>
                            </div>
                            <div class="info-row">
                                <svg class="icon">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                <span>
                                    <span class="members-count ${isFull ? 'full' : ''}">${post.currentMembers}</span>
                                    <span style="color: #666">/${post.maxMembers}ëª…</span>
                                    ${isFull ? '<span class="badge badge-full">ëª¨ì§‘ì™„ë£Œ</span>' : ''}
                                </span>
                            </div>
                        </div>
                        <div class="post-footer">
                            <div class="info-row">
                                <svg class="icon">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                <span>${post.author}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Filter tabs
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', (e) => {
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentCategory = e.target.dataset.category;
                renderPosts();
            });
        });

        // Show detail modal
        function showDetail(postId) {
  const post = posts.find(p => p.id === postId);
  if (!post) return;

  const isFull = post.currentMembers >= post.maxMembers;
  const badgeClass = `badge-${post.category}`;

  // âœ… ê¸°ë³¸ê°’ ì²˜ë¦¬ (ì—†ëŠ” ê¸€ì€ false / ë¹ˆ ë°°ì—´)
  const isAccepted = post.isAccepted === true;
  const comments = Array.isArray(post.comments) ? post.comments : [];

  document.getElementById('detailTitle').innerHTML = `
      ${post.title}
      <span class="badge ${badgeClass}" style="font-size: 0.875rem; margin-left: 0.5rem;">
        ${categoryLabels[post.category]}
      </span>
  `;

  // âœ… ëŒ“ê¸€ ë Œë”ë§ HTML
  const commentsHtml = isAccepted
    ? `
      <div class="detail-description">
        <div class="detail-label">ëŒ“ê¸€</div>

        <div class="comment-list">
          ${
            comments.length === 0
              ? `<p style="color:#666; font-size:0.9rem;">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>`
              : comments.map(c => `
                  <div class="comment-item">
                    <div class="comment-meta">
                      <span class="comment-writer">${c.writer}</span>
                      <span class="comment-date">${c.createdAt}</span>
                    </div>
                    <div class="comment-content">${c.content}</div>
                  </div>
                `).join('')
          }
        </div>

        <div class="comment-form">
          <textarea id="commentInput" class="form-textarea" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
          <div class="button-group" style="margin-top: 0.75rem;">
            <button class="button button-primary" onclick="addComment('${post.id}')">ëŒ“ê¸€ ë“±ë¡</button>
          </div>
        </div>
      </div>
    `
    : `
      <div class="detail-description">
        <div class="detail-label">ëŒ“ê¸€</div>
        <p style="color:#666; font-size:0.9rem;">
          âœ… ì°¸ì—¬ ì‹ ì²­ì´ ìˆ˜ë½ë˜ë©´ ëŒ“ê¸€ì„ ë³¼ ìˆ˜ ìˆì–´ìš”.
        </p>
      </div>
    `;

  document.getElementById('detailContent').innerHTML = `
      <div class="detail-grid">
        <div class="detail-item">
          <svg class="detail-icon">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <div class="detail-content">
            <div class="detail-label">ë‚ ì§œ ë° ì‹œê°„</div>
            <div class="detail-value">${post.date} ${post.time}</div>
          </div>
        </div>

        <div class="detail-item">
          <svg class="detail-icon">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          <div class="detail-content">
            <div class="detail-label">ì¥ì†Œ</div>
            <div class="detail-value">${post.location}</div>
          </div>
        </div>

        <div class="detail-item">
          <svg class="detail-icon">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          <div class="detail-content">
            <div class="detail-label">ëª¨ì§‘ ì¸ì›</div>
            <div class="detail-value">
              <span class="${isFull ? 'members-count full' : 'members-count'}">${post.currentMembers}</span>/${post.maxMembers}ëª…
              ${isFull ? '<span class="badge badge-full">ëª¨ì§‘ì™„ë£Œ</span>' : ''}
            </div>
          </div>
        </div>

        <div class="detail-item">
          <svg class="detail-icon">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <div class="detail-content">
            <div class="detail-label">ì‘ì„±ì</div>
            <div class="detail-value">${post.author}</div>
          </div>
        </div>
      </div>

      <div class="detail-description">
        <div class="detail-label">ìƒì„¸ ì„¤ëª…</div>
        <p class="description-text">${post.description}</p>
      </div>

      <div class="button-group">
        <button class="button button-primary"
          onclick="openApplyModal()"
          ${isFull ? 'disabled' : ''}>
          ${isFull ? 'ëª¨ì§‘ ì™„ë£Œ' : 'ì°¸ì—¬ ì‹ ì²­'}
        </button>
      </div>

      ${commentsHtml}
  `;

  document.getElementById('detailModal').classList.add('show');
}

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('show');
        }

        // Create post modal
        document.getElementById('createButton').addEventListener('click', () => {
            document.getElementById('createModal').classList.add('show');
        });

        function closeCreateModal() {
            document.getElementById('createModal').classList.remove('show');
            document.getElementById('createForm').reset();
        }

        // Handle form submission
        document.getElementById('createForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newPost = {
                id: Date.now().toString(),
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                location: document.getElementById('location').value,
                currentMembers: 1,
                maxMembers: parseInt(document.getElementById('maxMembers').value),
                author: document.getElementById('author').value,
                description: document.getElementById('description').value,
                createdAt: new Date().toISOString()
            };

            posts.unshift(newPost);
            renderPosts();
            closeCreateModal();
        });

        // Close modal when clicking overlay
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('show');
                }
            });
        });
        
        function openApplyModal() {
       	  document.getElementById('applyModal').classList.add('show');
       	}

       	function closeApplyModal() {
       	  document.getElementById('applyModal').classList.remove('show');
       	}

       	function onOverlayClick(e){
       	  if(e.target.id === 'applyModal'){
       	    closeApplyModal();
       	  }
       	}

       	function submitApply() {
       	  const message = document.getElementById('applyMessage').value;

       	  alert("ì‹ ì²­ ì™„ë£Œ!");
       	  closeApplyModal();
       	}
       	
       	function addComment(postId) {
       	  const post = posts.find(p => p.id === postId);
       	  if (!post) return;

       	  const input = document.getElementById('commentInput');
       	  const text = (input.value || '').trim();
       	  if (!text) {
       	    alert("ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”!");
       	    return;
       	  }

       	  if (!Array.isArray(post.comments)) post.comments = [];

       	  post.comments.push({
       	    id: 'c' + Date.now(),
       	    writer: 'ë‚˜(ë”ë¯¸ìœ ì €)',
       	    content: text,
       	    createdAt: new Date().toISOString().slice(0, 10)
       	  });

       	  input.value = '';
       	  showDetail(postId); // ë‹¤ì‹œ ê·¸ë ¤ì„œ ì¦‰ì‹œ ë°˜ì˜
       	}

        // Initial render
        renderPosts();
    </script>
</div>

</body>
</html>
	